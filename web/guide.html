<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8">
    <title>Instru√ß√µes - Keep Talking and Nobody Explodes</title>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #111;
        color: white;
        font-family: 'Courier New', monospace;
        overflow-y: auto;
      }

      .guide-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        padding-top: 80px;
        min-height: 80vh;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      /* Slides */
      .slide {
        display: none;
        animation: fadeIn 0.4s ease;
      }

      .slide.active {
        display: block;
      }

      /* Adjust current content toggling to just be a wrapper */
      .content {
        display: none;
      }
      .content.active {
        display: block;
      }

      /* Navigation */
      .nav-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #333;
      }

      .nav-controls.top {
        border-top: none;
        margin-top: 0;
        margin-bottom: 20px;
        padding-top: 0;
      }

      .progress-bar {
        width: 100%;
        max-width: 300px;
        height: 4px;
        background: #333;
        border-radius: 2px;
        overflow: hidden;
      }

      .progress {
        height: 100%;
        background: #e74c3c;
        width: 25%;
        transition: width 0.3s ease;
      }

      .nav-btn {
        padding: 10px 25px;
        background: #333;
        color: white;
        border: 1px solid #555;
        border-radius: 3px;
        cursor: pointer;
        font-family: inherit;
        font-weight: bold;
        transition: all 0.2s;
      }

      .nav-btn:hover:not(:disabled) {
        background: #e74c3c;
        border-color: #e74c3c;
      }

      .nav-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      #slide-indicator {
        color: #666;
        font-size: 0.9em;
        letter-spacing: 2px;
      }

      /* IST ID Form */
      .ist-id-container {
        margin-bottom: 20px;
        text-align: center;
      }
      
      .ist-id-container label {
        display: block;
        margin-bottom: 10px;
        color: #e74c3c;
        font-weight: bold;
        font-size: 1.1em;
      }
    
      .ist-id-input {
        display: block !important;
        background: #333 !important;
        border: 2px solid #555 !important;
        padding: 10px 15px !important;
        color: white !important;
        font-family: inherit;
        font-size: 1.1em !important;
        border-radius: 4px;
        width: 100% !important;
        max-width: 300px !important;
        height: 50px !important;
        margin: 0 auto !important;
        text-align: center;
        box-sizing: border-box !important;
        opacity: 1 !important;
      }

      .ist-id-input:focus {
        outline: none;
        border-color: #e74c3c !important;
      }
      
      /* Override any invalid styling */
      .ist-id-input:invalid {
        box-shadow: none;
      }

      /* Consent Form */
      .consent-form {
        text-align: left;
        background: #151515;
        border: 1px solid #333;
        padding: 30px;
      }

      .consent-item {
        margin-bottom: 20px;
        border-bottom: 1px solid #222;
        padding-bottom: 15px;
      }

      .consent-item:last-child {
        border-bottom: none;
      }

      .consent-item h3 {
        color: #ddd;
        font-size: 1.1em;
        margin-bottom: 5px;
      }

      .consent-item p {
        color: #999;
        font-size: 0.95em;
        line-height: 1.5;
      }

      .consent-check {
        margin-top: 30px;
        padding: 20px;
        background: #222;
        border: 1px solid #e74c3c;
        text-align: center;
      }

      .consent-check label {
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        color: #fff;
      }

      .consent-check input {
        width: 20px;
        height: 20px;
        accent-color: #e74c3c;
      }

      /* Common Styles */
      .guide-header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #fff;
        padding-bottom: 20px;
      }

      .guide-header h1 {
        font-size: 2em;
        margin-bottom: 10px;
        letter-spacing: 2px;
      }

      .guide-header p {
        font-size: 1em;
        color: #ccc;
      }
      
      .controls {
        background: #222;
        padding: 20px;
        border-left: 4px solid #e74c3c;
        margin-bottom: 30px;
      }
      
      .controls h2 { margin-bottom: 10px; color: #e74c3c; }
      .controls p { margin: 5px 0; }

      .description {
        background: #1a1a1a;
        padding: 25px;
        margin-bottom: 30px;
        border-radius: 5px;
        line-height: 1.6;
      }
      .description h2 { color: #3498db; margin-bottom: 15px; }
      .description p { margin-bottom: 10px; color: #ddd; }

      .rules-section { margin-bottom: 20px; }
      .rules-section h2 { font-size: 1.5em; margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px; }

      .rule-box {
        background: #222;
        border: 1px solid #444;
        padding: 15px;
        margin-bottom: 15px;
      }
      .rule-box h3 { color: #f39c12; font-size: 1.1em; margin-bottom: 10px; }
      .rule-box ul { margin-left: 20px; color: #ddd; }
      .rule-box li { margin-bottom: 5px; }

      .button-container {
        text-align: center;
        margin-top: 30px;
      }

      .start-game-btn {
        padding: 15px 40px;
        font-size: 1.1em;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-family: inherit;
        font-weight: bold;
        letter-spacing: 1px;
        background: #e74c3c;
        color: white;
        transition: all 0.3s;
      }

      .start-game-btn:hover {
        background: #c0392b;
        transform: scale(1.05);
      }

      /* Language Toggle - Global */
      .language-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
        z-index: 9999;
      }

      .lang-btn {
        padding: 10px 16px;
        background: rgba(51, 51, 51, 0.8);
        color: white;
        border: 2px solid rgba(85, 85, 85, 0.8);
        border-radius: 3px;
        cursor: pointer;
        font-family: 'Courier New', monospace;
        transition: all 0.3s ease;
        font-size: 14px;
        font-weight: bold;
        backdrop-filter: blur(10px);
      }

      .lang-btn:hover {
        border-color: #e74c3c;
        transform: translateY(-2px);
      }

      .lang-btn.active {
        background: #e74c3c;
        border-color: #e74c3c;
        box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
      }

      /* Content Toggling */
      .content {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      .content.active {
        display: block;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    </style>
  </head>
  <body>
    <!-- Language Toggle -->
    <div class="language-toggle">
      <button class="lang-btn active" data-lang="pt">PT</button>
      <button class="lang-btn" data-lang="en">EN</button>
    </div>

    <div class="guide-container">
      <!-- PORTUGUESE VERSION -->
    <div class="guide-container">
      
      <!-- NAVIGATION CONTROLS (Top) -->
      <div class="nav-controls top">
        <div class="progress-bar">
          <div class="progress" id="progress"></div>
        </div>
      </div>

      <!-- PORTUGUESE VERSION -->
      <div class="content active" data-lang="pt">
        
        <!-- SLIDE 1: CONSENT -->
        <div class="slide active" id="pt-slide-1">
          <div class="guide-header">
            <h1>CERTIFICADO DE CONSENTIMENTO</h1>
          </div>
          <div class="description consent-form">
            <div class="consent-item">
              <h3>Introdu√ß√£o</h3>
              <p>A nossa experi√™ncia consiste num jogo de desactiva√ß√£o de bombas, onde o participante ir√° interagir com um rob√¥ f√≠sico e uma intelig√™ncia artificial (IA). O objetivo √© estudar como o participante interage com ambos durante o jogo.</p>
              <p>N√£o tem de decidir participar imediatamente. Antes de tomar uma decis√£o, pode esclarecer quaisquer d√∫vidas que tenha sobre o estudo.</p>
            </div>
            
            <div class="consent-item">
              <h3>Objectivo do Estudo</h3>
              <p>O nosso objetivo √© analisar como o participante interage com o rob√¥ f√≠sico e a IA durante o jogo de desactiva√ß√£o de bombas. Ser√£o recolhidos dados sobre as interac√ß√µes, comunica√ß√£o e decis√µes tomadas, para compreender as estrat√©gias e sentimentos despertados por cada agente.</p>
            </div>
            
            <div class="consent-item">
              <h3>Selec√ß√£o de Participantes</h3>
              <p>A participa√ß√£o neste estudo est√° aberta a indiv√≠duos com 18 anos ou mais, com conhecimento escrito e verbal de portugu√™s ou ingl√™s.</p>
            </div>
            
            <div class="consent-item">
              <h3>Participa√ß√£o Volunt√°ria</h3>
              <p>A sua participa√ß√£o √© volunt√°ria, pelo que pode desistir a qualquer momento. Se recusar participar ou desejar desistir, n√£o haver√° qualquer penaliza√ß√£o.</p>
            </div>
            
            <div class="consent-item">
              <h3>Procedimento e Protocolo</h3>
              <p>Antes de come√ßar, ser√£o explicadas em detalhe todas as regras e objectivos do jogo. Recomenda-se que esclare√ßa quaisquer d√∫vidas durante esta fase. Depois jogar√° o jogo com assist√™ncia de um sistema de IA. Durante o jogo, ser√£o recolhidos dados de interac√ß√£o para fins de an√°lise.</p>
              <p>No final, ser-lhe-√° pedido que preencha um question√°rio sobre a sua experi√™ncia durante o jogo e a sua percep√ß√£o do sistema.</p>

              <h3>Recolha de Dados por Som e V√≠deo</h3>
              <p>Durante o jogo, ser√£o efectuadas grava√ß√µes de som e v√≠deo para an√°lise das interac√ß√µes e comportamentos. Estas grava√ß√µes ser√£o utilizadas exclusivamente para fins cient√≠ficos e ser√£o tratadas de forma confidencial.</p>
            </div>
            
            <div class="consent-item">
              <h3>Riscos</h3>
              <p>Os riscos de participa√ß√£o neste estudo n√£o s√£o superiores ao que esperaria da sua vida quotidiana. Os formul√°rios de consentimento e outros dados pessoais n√£o ser√£o armazenados juntamente com as interac√ß√µes registadas. Os participantes ser√£o identificados por um n√∫mero e o seu nome e outras informa√ß√µes identific√°veis nunca ser√£o revelados.</p>
            </div>
            
            <div class="consent-item">
              <h3>Benef√≠cios</h3>
              <p>N√£o esperamos que a participa√ß√£o neste estudo incorra em qualquer tipo de benef√≠cio pessoal. No entanto, contribuir√° directamente para esta investiga√ß√£o com conhecimento que poder√° ser extra√≠do em an√°lises subsequentes e estudos consequentes, contribuindo para o progresso cient√≠fico nesta √°rea de investiga√ß√£o.</p>
            </div>
            
            <div class="consent-item">
              <h3>Confidencialidade</h3>
              <p>Os dados recolhidos durante o estudo e o formul√°rio de consentimento ser√£o mantidos separados. As informa√ß√µes recolhidas ser√£o mantidas de forma segura num servidor e identificadas por um identificador num√©rico, para que n√£o possam ser associadas a nenhum dos seus dados, como nome, morada ou contactos. Estes dados ser√£o acess√≠veis apenas pelos investigadores envolvidos no projecto.</p>
            </div>
            
            <div class="consent-item">
              <h3>Finalidade do Tratamento e Armazenamento de Dados</h3>
              <p>Os seus dados pessoais ser√£o processados para fins de investiga√ß√£o que visa compreender os comportamentos de colabora√ß√£o humano-IA no contexto de jogos de desactiva√ß√£o de bombas. Ser√£o armazenados por um per√≠odo m√°ximo de 6 meses.</p>
            </div>
            
            <div class="consent-item">
              <h3>Os Seus Direitos</h3>
              <p>Como titular dos dados, tem o direito de aceder aos seus dados pessoais, de os rectificar, de os apagar, de restringir o processamento, de se opor ao processamento, bem como √† portabilidade dos dados. Pode tamb√©m apresentar queixa √† Comiss√£o Nacional de Protec√ß√£o de Dados.</p>
            </div>
            
            <div class="consent-item">
              <h3>Contactos</h3>
              <p>Se tiver alguma d√∫vida ou quest√£o, pode esclarec√™-las agora, mais tarde, ou mesmo durante o estudo. Para quest√µes, contacte: rodrigo.correia.salgueiro@tecnico.ulisboa.pt, beatriz.martinho@tecnico.ulisboa.pt ou francisca.vicente.de.almeida@tecnico.ulisboa.pt.</p>
            </div>
            
            <div class="consent-check">
              <div class="ist-id-container">
                <label for="ist-id-pt">N√∫mero de Estudante / IST ID:</label>
                <input type="text" id="ist-id-pt" class="ist-id-input" placeholder="e.g. ist1100000" required>
              </div>
              <label>
                <input type="checkbox" class="consent-checkbox"> 
                <strong>Declaro que li a descri√ß√£o informativa acima. Tive a oportunidade de questionar os investigadores sobre a experi√™ncia e todas as quest√µes foram respondidas. Reconhe√ßo que fui informado sobre o direito de retirar o meu consentimento. Tamb√©m reconhe√ßo que fui informado sobre os meus direitos de aceder aos meus dados pessoais, de os rectificar, de os apagar, de restringir o processamento, de me opor ao processamento, bem como √† portabilidade dos dados. Concordo voluntariamente em participar no estudo e consinto a recolha dos meus dados pessoais para fins cient√≠ficos.</strong>
              </label>
            </div>
          </div>
        </div>

        <!-- SLIDE 2: BRIEFING -->
        <div class="slide" id="pt-slide-2">
          <div class="guide-header">
            <h1>MANUAL DE DESATIVA√á√ÉO</h1>
            <p>Informa√ß√£o Geral</p>
          </div>

          <div class="controls">
            <h2>üéÆ Controlos</h2>
            <p>üñ±Ô∏è <strong>Rato:</strong> Rodar a cena em volta</p>
            <p>üîç <strong>Roda do rato:</strong> Fazer zoom in/out</p>
          </div>

          <div class="description">
            <h2>üìã Sobre o Jogo</h2>
            <p>
              Bem-vindo ao desafio de desmantelamento de bombas! 
              Neste jogo ir√°s escolher um fio para cortar com a ajuda de um LLM e de um rob√¥.
            </p>
            <p>
              Siga atentamente as regras fornecidas abaixo para determinar qual fio deve ser cortado.
            </p>
          </div>
        </div>

        <!-- SLIDE 3: WIRES PART 1 -->
        <div class="slide" id="pt-slide-3">
          <div class="rules-section">
            <h2>‚öôÔ∏è GUIA DE FIOS (1/2)</h2>

            <div class="rule-box">
              <h3>Informa√ß√µes Importantes</h3>
              <ul>
                <li>O m√≥dulo de fios pode conter entre <strong>3 a 6 fios</strong></li>
                <li>Apenas o fio correto precisa ser cortado para desarmar o m√≥dulo</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>3 Fios</h3>
              <ul>
                <li>Se <strong>n√£o houver fios vermelhos</strong>, corta o segundo fio</li>
                <li>Caso contr√°rio, se o √∫ltimo fio for <strong>branco</strong>, corta o √∫ltimo fio</li>
                <li>Caso contr√°rio, se <strong>houver mais de um fio azul</strong>, corta o √∫ltimo fio azul</li>
                <li>Caso contr√°rio, corta o √∫ltimo fio</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>4 Fios</h3>
              <ul>
                <li>Se <strong>houver mais de um fio vermelho</strong> e o √∫ltimo d√≠gito do n√∫mero de s√©rie for <strong>√≠mpar</strong>, corta o √∫ltimo fio vermelho</li>
                <li>Caso contr√°rio, se o √∫ltimo fio for <strong>amarelo</strong> e n√£o existirem fios vermelhos, corta o primeiro fio</li>
                <li>Caso contr√°rio, se <strong>existir exatamente um fio azul</strong>, corta o primeiro fio</li>
                <li>Caso contr√°rio, se <strong>existir mais de um fio amarelo</strong>, corta o √∫ltimo fio</li>
                <li>Caso contr√°rio, corta o segundo fio</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- SLIDE 4: WIRES PART 2 -->
        <div class="slide" id="pt-slide-4">
          <div class="rules-section">
            <h2>‚öôÔ∏è GUIA DE FIOS (2/2)</h2>

            <div class="rule-box">
              <h3>5 Fios</h3>
              <ul>
                <li>Se o √∫ltimo fio for <strong>preto</strong> e o √∫ltimo d√≠gito do n√∫mero de s√©rie for <strong>√≠mpar</strong>, corta o quarto fio</li>
                <li>Caso contr√°rio, se <strong>existir exatamente um fio vermelho</strong> e houver mais de um fio amarelo, corta o primeiro fio</li>
                <li>Caso contr√°rio, se <strong>n√£o existirem fios pretos</strong>, corta o segundo fio</li>
                <li>Caso contr√°rio, corta o primeiro fio</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>6 Fios</h3>
              <ul>
                <li>Se <strong>n√£o existirem fios amarelos</strong> e o √∫ltimo d√≠gito do n√∫mero de s√©rie for <strong>√≠mpar</strong>, corta o terceiro fio</li>
                <li>Caso contr√°rio, se <strong>existir exatamente um fio amarelo</strong> e houver mais de um fio branco, corta o quarto fio</li>
                <li>Caso contr√°rio, se <strong>n√£o existirem fios vermelhos</strong>, corta o √∫ltimo fio</li>
                <li>Caso contr√°rio, corta o quarto fio</li>
              </ul>
            </div>
          </div>

          <div class="button-container">
            <button class="start-game-btn">‚ñ∂ COME√áAR JOGO</button>
          </div>
        </div>
      </div>

      <!-- ENGLISH VERSION -->
      <div class="content" data-lang="en">
        
        <!-- SLIDE 1: CONSENT -->
        <div class="slide active" id="en-slide-1">
          <div class="guide-header">
            <h1>CERTIFICATE OF CONSENT</h1>
          </div>
          <div class="description consent-form">
            <div class="consent-item">
              <h3>Introduction</h3>
              <p>Our experiment is a bomb defuse game where the participant will interact with a physical robot and an AI. The aim is to study how the participant interacts with both during the game.</p>
              <p>You do not have to decide whether to take part immediately. Before making your decision, you can choose to clarify any doubts you may have about the study.</p>
            </div>
            
            <div class="consent-item">
              <h3>Purpose of the Study</h3>
              <p>Our goal is to analyze how the participant interacts with both the physical robot and the AI during the bomb defuse game. We will collect data on interactions, communication, and decisions to understand the strategies and feelings elicited by each agent.</p>
            </div>
            
            <div class="consent-item">
              <h3>Selection of Participants</h3>
              <p>Participation in this study is open to individuals aged 18 or over with written and verbal knowledge of English or Portuguese.</p>
            </div>
            
            <div class="consent-item">
              <h3>Voluntary Participation</h3>
              <p>Your participation is voluntary, so you can withdraw at any time. If you refuse to participate or wish to withdraw, there will be no penalty.</p>
            </div>
            
            <div class="consent-item">
              <h3>Procedure and Protocol</h3>
              <p>Before starting, all the rules and objectives of the game will be explained in detail. It is recommended that you clarify any doubts you may have during this phase. You will then play the game with assistance from an AI system. During the game, interaction data will be collected for analysis purposes.</p>
              <p>At the end, you will be asked to fill in a questionnaire about your experience during the game and your perception of the system.</p>

              <h3>Audio and Video Data Collection</h3>
              <p>During the game, audio and video recordings will be made to analyze interactions and behaviors. These recordings will be used exclusively for scientific purposes and will be handled confidentially.</p>
            </div>
            
            <div class="consent-item">
              <h3>Risks</h3>
              <p>The risks of participation in this study are not superior to what you would expect from your daily life. Consent forms and other personal data will not be stored together with the recorded interactions. Participants will be matched with a number and their name and other identifiable information will never be revealed.</p>
            </div>
            
            <div class="consent-item">
              <h3>Benefits</h3>
              <p>We do not expect participation in this study to incur any kind of personal benefit. However, it will contribute directly to this research with knowledge that may be extracted in subsequent analyses and consequent studies, contributing to scientific progress in this area of research.</p>
            </div>
            
            <div class="consent-item">
              <h3>Confidentiality</h3>
              <p>The data collected during the study and the consent form will be kept separate. The information collected will be kept securely on a server and will be identified by a numerical identifier, so that it cannot be associated with any of your data, such as name, address, or contact details. This data will only be accessible by the researchers involved in the project.</p>
            </div>
            
            <div class="consent-item">
              <h3>Purpose of Data Processing and Data Storage</h3>
              <p>Your personal data will be processed for the purpose of research that aims to understand human-AI collaboration behaviours in the context of bomb defusal games. It will be stored for a maximum period of 6 months.</p>
            </div>
            
            <div class="consent-item">
              <h3>Your Rights</h3>
              <p>As a data subject, you have the right to access your personal data, to rectify them, to erase them, to restrict processing, to object to processing as well as to data portability. You can also lodge a complaint with Comiss√£o Nacional de Prote√ß√£o de Dados.</p>
            </div>
            
            <div class="consent-item">
              <h3>Contacts</h3>
              <p>If you have any doubts or questions, you can ask them now, later, or even during the study. For questions, you can contact: rodrigo.correia.salgueiro@tecnico.ulisboa.pt, beatriz.martinho@tecnico.ulisboa.pt or francisca.vicente.de.almeida@tecnico.ulisboa.pt.</p>
            </div>
            
            <div class="consent-check">
              <div class="ist-id-container">
                <label for="ist-id-en">Student Number / IST ID:</label>
                <input type="text" id="ist-id-en" class="ist-id-input" placeholder="e.g. ist1105901" required>
              </div>
              <label>
                <input type="checkbox" class="consent-checkbox"> 
                <strong>I declare that I read the informative description above. I had the opportunity of inquiring the researchers about the experiment and all the questions were answered. I acknowledge that I was informed about the right to withdraw my consent. I also acknowledge that I was informed about my rights to access my personal data, to rectify them, to erase them, to restrict processing, to object to processing as well as to data portability. I voluntarily agree to participate in the study and I consent to the collection of my personal data for scientific purposes.</strong>
              </label>
            </div>
          </div>
        </div>

        <!-- SLIDE 2: BRIEFING -->
        <div class="slide" id="en-slide-2">
          <div class="guide-header">
            <h1>DEFUSAL MANUAL</h1>
            <p>General Information</p>
          </div>

          <div class="controls">
            <h2>üéÆ Controls</h2>
            <p>üñ±Ô∏è <strong>Mouse:</strong> Rotate the scene around</p>
            <p>üîç <strong>Mouse wheel:</strong> Zoom in/out</p>
          </div>

          <div class="description">
            <h2>üìã About the Game</h2>
            <p>
              Welcome to the bomb defusal challenge! 
              In this game you will choose a wire to cut with the help of an LLM and a robot.
            </p>
            <p>
              Follow the rules provided below carefully to determine which wire should be cut.
            </p>
          </div>
        </div>

        <!-- SLIDE 3: WIRES PART 1 -->
        <div class="slide" id="en-slide-3">
          <div class="rules-section">
            <h2>‚öôÔ∏è WIRE GUIDE (1/2)</h2>

            <div class="rule-box">
              <h3>Important Information</h3>
              <ul>
                <li>The wire module may contain between <strong>3 to 6 wires</strong></li>
                <li>Only the correct wire needs to be cut to defuse the module</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>3 Wires</h3>
              <ul>
                <li>If <strong>there are no red wires</strong>, cut the second wire</li>
                <li>Otherwise, if the last wire is <strong>white</strong>, cut the last wire</li>
                <li>Otherwise, if <strong>there is more than one blue wire</strong>, cut the last blue wire</li>
                <li>Otherwise, cut the last wire</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>4 Wires</h3>
              <ul>
                <li>If <strong>there is more than one red wire</strong> and the last digit of the serial number is <strong>odd</strong>, cut the last red wire</li>
                <li>Otherwise, if the last wire is <strong>yellow</strong> and there are no red wires, cut the first wire</li>
                <li>Otherwise, if <strong>there is exactly one blue wire</strong>, cut the first wire</li>
                <li>Otherwise, if <strong>there is more than one yellow wire</strong>, cut the last wire</li>
                <li>Otherwise, cut the second wire</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- SLIDE 4: WIRES PART 2 -->
        <div class="slide" id="en-slide-4">
          <div class="rules-section">
            <h2>‚öôÔ∏è WIRE GUIDE (2/2)</h2>

            <div class="rule-box">
              <h3>5 Wires</h3>
              <ul>
                <li>If the last wire is <strong>black</strong> and the last digit of the serial number is <strong>odd</strong>, cut the fourth wire</li>
                <li>Otherwise, if <strong>there is exactly one red wire</strong> and there is more than one yellow wire, cut the first wire</li>
                <li>Otherwise, if <strong>there are no black wires</strong>, cut the second wire</li>
                <li>Otherwise, cut the first wire</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>6 Wires</h3>
              <ul>
                <li>If <strong>there are no yellow wires</strong> and the last digit of the serial number is <strong>odd</strong>, cut the third wire</li>
                <li>Otherwise, if <strong>there is exactly one yellow wire</strong> and there is more than one white wire, cut the fourth wire</li>
                <li>Otherwise, if <strong>there are no red wires</strong>, cut the last wire</li>
                <li>Otherwise, cut the fourth wire</li>
              </ul>
            </div>
          </div>

          <div class="button-container">
            <button class="start-game-btn">‚ñ∂ START GAME</button>
          </div>
        </div>
      </div>

      <!-- FOOTER NAVIGATION -->
      <div class="nav-controls bottom">
        <button id="prev-slide" class="nav-btn" disabled>‚Üê BACK</button>
        <span id="slide-indicator">1 / 4</span>
        <button id="next-slide" class="nav-btn">NEXT ‚Üí</button>
      </div>
    </div>

    <script>
      // --- Language & Slide Management ---
      let currentLang = 'pt';
      let currentSlideIndex = 0;
      const totalSlides = 4;
      
      const langButtons = document.querySelectorAll('.lang-btn');
      const contentWrappers = document.querySelectorAll('.content');
      
      // Navigation Elements
      const prevBtn = document.getElementById('prev-slide');
      const nextBtn = document.getElementById('next-slide');
      const slideIndicator = document.getElementById('slide-indicator');
      const checkboxes = document.querySelectorAll('.consent-checkbox');
      const idInputs = document.querySelectorAll('.ist-id-input');
      const startButtons = document.querySelectorAll('.start-game-btn');
      const progressFill = document.getElementById('progress');

      // Titles
      const titles = {
        pt: "Instru√ß√µes - Keep Talking and Nobody Explodes",
        en: "Guide - Keep Talking and Nobody Explodes"
      };

      // Initialize
      function init() {
        updateSlideVisibility();
        setupEventListeners();
      }

      function setupEventListeners() {
        // Language Toggles
        langButtons.forEach(btn => {
          btn.addEventListener('click', () => {
             const lang = btn.getAttribute('data-lang');
             setLanguage(lang);
          });
        });

        // Navigation
        prevBtn.addEventListener('click', () => changeSlide(-1));
        nextBtn.addEventListener('click', () => changeSlide(1));


        // Start Game
        startButtons.forEach(btn => {
          btn.addEventListener('click', () => {
             // Get ID from the active input (or just take the one that has a value)
            let istId = document.getElementById('ist-id-pt').value.trim() || document.getElementById('ist-id-en').value.trim();
            if (!istId) istId = 'unknown'; // Should be prevented by validation

            const params = new URLSearchParams(window.location.search);
            const condition = params.get('condition') || 'a';
            window.location.href = `/bomb.html?condition=${condition}&participantId=${encodeURIComponent(istId)}`;
          });
        });

        // Input Validation (ID inputs)
        idInputs.forEach(input => {
          input.addEventListener('input', (e) => {
             // Sync inputs
             const val = e.target.value;
             idInputs.forEach(i => i.value = val);
             updateNavigationState();
          });
        });

        // Consent Checkboxes - Enable Next button
        checkboxes.forEach(box => {
          box.addEventListener('change', (e) => {
            // Sync checkboxes across languages for convenience
            checkboxes.forEach(cb => cb.checked = e.target.checked);
            updateNavigationState();
          });
        });
      }

      function setLanguage(lang) {
        currentLang = lang;
        
        // Update UI logic
        document.documentElement.lang = currentLang;
        document.title = titles[currentLang];
        
        // Toggle Buttons
        langButtons.forEach(btn => {
          if (btn.getAttribute('data-lang') === lang) btn.classList.add('active');
          else btn.classList.remove('active');
        });

        // Toggle Content Wrapper
        contentWrappers.forEach(wrapper => {
          if (wrapper.getAttribute('data-lang') === lang) wrapper.classList.add('active');
          else wrapper.classList.remove('active');
        });

        updateSlideVisibility();
      }

      function changeSlide(direction) {
        const newIndex = currentSlideIndex + direction;
        if (newIndex >= 0 && newIndex < totalSlides) {
          currentSlideIndex = newIndex;
          updateSlideVisibility();
        }
      }

      function updateSlideVisibility() {
        // Hide all slides in ALL languages (to be safe)
        document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));

        // Show current slide for current language
        const activeSlideId = `${currentLang}-slide-${currentSlideIndex + 1}`;
        const activeSlide = document.getElementById(activeSlideId);
        if (activeSlide) {
          activeSlide.classList.add('active');
        }

        // Update Indicator
        slideIndicator.textContent = `${currentSlideIndex + 1} / ${totalSlides}`;
        
        // Update Progress Bar
        const progressPct = ((currentSlideIndex + 1) / totalSlides) * 100;
        if (progressFill) progressFill.style.width = `${progressPct}%`;

        updateNavigationState();
      }

      function updateNavigationState() {
        // Prev Button
        prevBtn.disabled = currentSlideIndex === 0;

        // Next Button Logic
        if (currentSlideIndex === totalSlides - 1) {
          nextBtn.style.display = 'none'; // Hide on last slide
        } else {
          nextBtn.style.display = 'inline-block';
          
          
          // Special Case: Slide 1 (Consent)
          if (currentSlideIndex === 0) {
            const currentWrapper = document.querySelector(`.content[data-lang="${currentLang}"]`);
            const isChecked = currentWrapper.querySelector('.consent-checkbox')?.checked;
            const hasId = currentWrapper.querySelector('.ist-id-input')?.value.trim().length > 0;
            
            nextBtn.disabled = !(isChecked && hasId);
          } else {
            nextBtn.disabled = false;
          }
        }
      }

      // Start
      init();
    </script>
  
    <script>
      // Play the guide theme on the guide page only.
      (function() {
        try {
          const theme = new Audio('/audio/csgo_main_theme.mp3');
          theme.loop = true;
          theme.volume = 0.05;

          const tryPlay = () => {
            theme.play().catch(() => {
              // Will retry after user gesture
            });
          };

          // Try to play immediately (may be blocked by autoplay policies)
          tryPlay();

          // Ensure it starts on first user gesture if blocked
          const resume = () => { tryPlay(); window.removeEventListener('click', resume); window.removeEventListener('keydown', resume); };
          window.addEventListener('click', resume);
          window.addEventListener('keydown', resume);
        } catch (e) {
          // ignore if audio cannot be created
        }
      })();
    </script>
  </body>
</html>