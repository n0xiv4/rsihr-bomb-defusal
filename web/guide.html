<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8">
    <title>Instru√ß√µes - Keep Talking and Nobody Explodes</title>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #111;
        color: white;
        font-family: 'Courier New', monospace;
        overflow-y: auto;
      }

      .guide-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        padding-top: 80px;
        min-height: 80vh;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      /* Slides */
      .slide {
        display: none;
        animation: fadeIn 0.4s ease;
      }

      .slide.active {
        display: block;
      }

      /* Adjust current content toggling to just be a wrapper */
      .content {
        display: none;
      }
      .content.active {
        display: block;
      }

      /* Navigation */
      .nav-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #333;
      }

      .nav-controls.top {
        border-top: none;
        margin-top: 0;
        margin-bottom: 20px;
        padding-top: 0;
      }

      .progress-bar {
        width: 100%;
        max-width: 300px;
        height: 4px;
        background: #333;
        border-radius: 2px;
        overflow: hidden;
      }

      .progress {
        height: 100%;
        background: #e74c3c;
        width: 25%;
        transition: width 0.3s ease;
      }

      .nav-btn {
        padding: 10px 25px;
        background: #333;
        color: white;
        border: 1px solid #555;
        border-radius: 3px;
        cursor: pointer;
        font-family: inherit;
        font-weight: bold;
        transition: all 0.2s;
      }

      .nav-btn:hover:not(:disabled) {
        background: #e74c3c;
        border-color: #e74c3c;
      }

      .nav-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      #slide-indicator {
        color: #666;
        font-size: 0.9em;
        letter-spacing: 2px;
      }

      /* IST ID Form */
      .ist-id-container {
        margin-bottom: 20px;
        text-align: center;
      }
      
      .ist-id-container label {
        display: block;
        margin-bottom: 10px;
        color: #e74c3c;
        font-weight: bold;
        font-size: 1.1em;
      }
    
      .ist-id-input {
        display: block !important;
        background: #333 !important;
        border: 2px solid #555 !important;
        padding: 10px 15px !important;
        color: white !important;
        font-family: inherit;
        font-size: 1.1em !important;
        border-radius: 4px;
        width: 100% !important;
        max-width: 300px !important;
        height: 50px !important;
        margin: 0 auto !important;
        text-align: center;
        box-sizing: border-box !important;
        opacity: 1 !important;
      }

      .ist-id-input:focus {
        outline: none;
        border-color: #e74c3c !important;
      }
      
      /* Override any invalid styling */
      .ist-id-input:invalid {
        box-shadow: none;
      }

      /* Consent Form */
      .consent-form {
        text-align: left;
        background: #151515;
        border: 1px solid #333;
        padding: 30px;
      }

      .consent-item {
        margin-bottom: 20px;
        border-bottom: 1px solid #222;
        padding-bottom: 15px;
      }

      .consent-item:last-child {
        border-bottom: none;
      }

      .consent-item h3 {
        color: #ddd;
        font-size: 1.1em;
        margin-bottom: 5px;
      }

      .consent-item p {
        color: #999;
        font-size: 0.95em;
        line-height: 1.5;
      }

      .consent-check {
        margin-top: 30px;
        padding: 20px;
        background: #222;
        border: 1px solid #e74c3c;
        text-align: center;
      }

      .consent-check label {
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        color: #fff;
      }

      .consent-check input {
        width: 20px;
        height: 20px;
        accent-color: #e74c3c;
      }

      /* Common Styles */
      .guide-header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #fff;
        padding-bottom: 20px;
      }

      .guide-header h1 {
        font-size: 2em;
        margin-bottom: 10px;
        letter-spacing: 2px;
      }

      .guide-header p {
        font-size: 1em;
        color: #ccc;
      }
      
      .controls {
        background: #222;
        padding: 20px;
        border-left: 4px solid #e74c3c;
        margin-bottom: 30px;
      }
      
      .controls h2 { margin-bottom: 10px; color: #e74c3c; }
      .controls p { margin: 5px 0; }

      .description {
        background: #1a1a1a;
        padding: 25px;
        margin-bottom: 30px;
        border-radius: 5px;
        line-height: 1.6;
      }
      .description h2 { color: #3498db; margin-bottom: 15px; }
      .description p { margin-bottom: 10px; color: #ddd; }

      .rules-section { margin-bottom: 20px; }
      .rules-section h2 { font-size: 1.5em; margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px; }

      .rule-box {
        background: #222;
        border: 1px solid #444;
        padding: 15px;
        margin-bottom: 15px;
      }
      .rule-box h3 { color: #f39c12; font-size: 1.1em; margin-bottom: 10px; }
      .rule-box ul { margin-left: 20px; color: #ddd; }
      .rule-box li { margin-bottom: 5px; }

      .info-box {
        background: #1a3a3a;
        border-left: 4px solid #27ae60;
        padding: 15px;
        margin-top: 15px;
        font-style: italic;
      }

      .button-container {
        text-align: center;
        margin-top: 30px;
      }

      .start-game-btn {
        padding: 15px 40px;
        font-size: 1.1em;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-family: inherit;
        font-weight: bold;
        letter-spacing: 1px;
        background: #e74c3c;
        color: white;
        transition: all 0.3s;
      }

      .start-game-btn:hover {
        background: #c0392b;
        transform: scale(1.05);
      }

      /* Language Toggle - Global */
      .language-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
        z-index: 9999;
      }

      .lang-btn {
        padding: 10px 16px;
        background: rgba(51, 51, 51, 0.8);
        color: white;
        border: 2px solid rgba(85, 85, 85, 0.8);
        border-radius: 3px;
        cursor: pointer;
        font-family: 'Courier New', monospace;
        transition: all 0.3s ease;
        font-size: 14px;
        font-weight: bold;
        backdrop-filter: blur(10px);
      }

      .lang-btn:hover {
        border-color: #e74c3c;
        transform: translateY(-2px);
      }

      .lang-btn.active {
        background: #e74c3c;
        border-color: #e74c3c;
        box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
      }

      /* Content Toggling */
      .content {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      .content.active {
        display: block;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    </style>
  </head>
  <body>
    <!-- Language Toggle -->
    <div class="language-toggle">
      <button class="lang-btn active" data-lang="pt">PT</button>
      <button class="lang-btn" data-lang="en">EN</button>
    </div>

    <div class="guide-container">
      <!-- PORTUGUESE VERSION -->
    <div class="guide-container">
      
      <!-- NAVIGATION CONTROLS (Top) -->
      <div class="nav-controls top">
        <div class="progress-bar">
          <div class="progress" id="progress"></div>
        </div>
      </div>

      <!-- PORTUGUESE VERSION -->
      <div class="content active" data-lang="pt">
        
        <!-- SLIDE 1: CONSENT -->
        <div class="slide active" id="pt-slide-1">
          <div class="guide-header">
            <h1>CERTIFICADO DE CONSENTIMENTO</h1>
          </div>
          <div class="description consent-form">
            <div class="consent-item">
              <h3>Anonimato e confidencialidade</h3>
              <p>Compreendo que ao fornecer um ID num√©rico, nenhum dos dados recolhidos me identifica. Os dados ser√£o associados ao ID an√≥nimo da experi√™ncia.</p>
            </div>
            <div class="consent-item">
              <h3>Participa√ß√£o Volunt√°ria</h3>
              <p>Compreendo que a minha participa√ß√£o nesta investiga√ß√£o √© inteiramente volunt√°ria. √â minha escolha participar ou n√£o.</p>
            </div>
            <div class="consent-item">
              <h3>Direito de Recusa ou Desist√™ncia</h3>
              <p>Posso desistir a qualquer momento sem justifica√ß√£o.</p>
            </div>
            <div class="consent-item">
              <h3>Recolha de Dados</h3>
              <p>Autorizo que os dados recolhidos no jogo e as respostas ao question√°rio sejam recolhidos e armazenados.</p>
            </div>
            <div class="consent-item">
              <h3>Partilha de Resultados</h3>
              <p>Autorizo o tratamento dos dados recolhidos para este projeto com o objetivo de an√°lise, investiga√ß√£o e divulga√ß√£o de resultados em revistas cient√≠ficas ou confer√™ncias.</p>
            </div>
            <div class="consent-item">
              <h3>Reembolsos</h3>
              <p>Ser√° fornecido um incentivo econ√≥mico de um bilhete de cinema NOS pela sua participa√ß√£o.</p>
            </div>
            
            <div class="consent-check">
              <div class="ist-id-container">
                <label for="ist-id-pt">N√∫mero de Estudante / IST ID:</label>
                <input type="text" id="ist-id-pt" class="ist-id-input" placeholder="e.g. ist1100000" required>
              </div>
              <label>
                <input type="checkbox" class="consent-checkbox"> 
                <strong>Li e compreendo a informa√ß√£o acima.</strong>
              </label>
            </div>
          </div>
        </div>

        <!-- SLIDE 2: BRIEFING -->
        <div class="slide" id="pt-slide-2">
          <div class="guide-header">
            <h1>MANUAL DE DESATIVA√á√ÉO</h1>
            <p>Informa√ß√£o Geral</p>
          </div>

          <div class="controls">
            <h2>üéÆ Controlos</h2>
            <p>üñ±Ô∏è <strong>Rato:</strong> Rodar a cena em volta</p>
            <p>üîç <strong>Roda do rato:</strong> Fazer zoom in/out</p>
          </div>

          <div class="description">
            <h2>üìã Sobre o Jogo</h2>
            <p>
              Bem-vindo ao desafio de desmantelamento de bombas! 
              Neste jogo ir√°s escolher um fio para cortar com a ajuda de um LLM e de um rob√¥.
            </p>
            <p>
              Siga atentamente as regras fornecidas abaixo para determinar qual fio deve ser cortado.
            </p>
          </div>
        </div>

        <!-- SLIDE 3: WIRES PART 1 -->
        <div class="slide" id="pt-slide-3">
          <div class="rules-section">
            <h2>‚öôÔ∏è GUIA DE FIOS (1/2)</h2>

            <div class="rule-box">
              <h3>Informa√ß√µes Importantes</h3>
              <ul>
                <li>O m√≥dulo de fios pode conter entre <strong>3 a 6 fios</strong></li>
                <li>Apenas o fio correto precisa ser cortado para desarmar o m√≥dulo</li>
                <li>A ordem dos fios come√ßa com o primeiro no topo</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>3 Fios</h3>
              <ul>
                <li>Se <strong>n√£o houver fios vermelhos</strong>, corta o segundo fio</li>
                <li>Caso contr√°rio, se o √∫ltimo fio for <strong>branco</strong>, corta o √∫ltimo fio</li>
                <li>Caso contr√°rio, se <strong>houver mais de um fio azul</strong>, corta o √∫ltimo fio azul</li>
                <li>Caso contr√°rio, corta o √∫ltimo fio</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>4 Fios</h3>
              <ul>
                <li>Se <strong>houver mais de um fio vermelho</strong> e o √∫ltimo d√≠gito do n√∫mero de s√©rie for <strong>√≠mpar</strong>, corta o √∫ltimo fio vermelho</li>
                <li>Caso contr√°rio, se o √∫ltimo fio for <strong>amarelo</strong> e n√£o existirem fios vermelhos, corta o primeiro fio</li>
                <li>Caso contr√°rio, se <strong>existir exatamente um fio azul</strong>, corta o primeiro fio</li>
                <li>Caso contr√°rio, se <strong>existir mais de um fio amarelo</strong>, corta o √∫ltimo fio</li>
                <li>Caso contr√°rio, corta o segundo fio</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- SLIDE 4: WIRES PART 2 -->
        <div class="slide" id="pt-slide-4">
          <div class="rules-section">
            <h2>‚öôÔ∏è GUIA DE FIOS (2/2)</h2>

            <div class="rule-box">
              <h3>5 Fios</h3>
              <ul>
                <li>Se o √∫ltimo fio for <strong>preto</strong> e o √∫ltimo d√≠gito do n√∫mero de s√©rie for <strong>√≠mpar</strong>, corta o quarto fio</li>
                <li>Caso contr√°rio, se <strong>existir exatamente um fio vermelho</strong> e houver mais de um fio amarelo, corta o primeiro fio</li>
                <li>Caso contr√°rio, se <strong>n√£o existirem fios pretos</strong>, corta o segundo fio</li>
                <li>Caso contr√°rio, corta o primeiro fio</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>6 Fios</h3>
              <ul>
                <li>Se <strong>n√£o existirem fios amarelos</strong> e o √∫ltimo d√≠gito do n√∫mero de s√©rie for <strong>√≠mpar</strong>, corta o terceiro fio</li>
                <li>Caso contr√°rio, se <strong>existir exatamente um fio amarelo</strong> e houver mais de um fio branco, corta o quarto fio</li>
                <li>Caso contr√°rio, se <strong>n√£o existirem fios vermelhos</strong>, corta o √∫ltimo fio</li>
                <li>Caso contr√°rio, corta o quarto fio</li>
              </ul>
            </div>

            <div class="info-box">
              ‚ÑπÔ∏è <strong>Dica:</strong> Estuda atentamente o m√≥dulo antes de qualquer a√ß√£o. 
              Identifica cada fio pela cor e acompanha a sequ√™ncia correta da regra correspondente.
            </div>
          </div>

          <div class="button-container">
            <button class="start-game-btn">‚ñ∂ COME√áAR JOGO</button>
          </div>
        </div>
      </div>

      <!-- ENGLISH VERSION -->
      <div class="content" data-lang="en">
        
        <!-- SLIDE 1: CONSENT -->
        <div class="slide active" id="en-slide-1">
          <div class="guide-header">
            <h1>CERTIFICATE OF CONSENT</h1>
          </div>
          <div class="description consent-form">
            <div class="consent-item">
              <h3>Anonymity and confidentiality</h3>
              <p>I understand that by providing a number ID, none of the collected data identifies myself. The data will be associated with the anonymous ID of the experiment.</p>
            </div>
            <div class="consent-item">
              <h3>Voluntary Participation</h3>
              <p>I understand that my participation in this research is entirely voluntary. It is my choice whether to participate or not.</p>
            </div>
            <div class="consent-item">
              <h3>Right to Refuse or Withdraw</h3>
              <p>I can withdraw at any time without explanation.</p>
            </div>
            <div class="consent-item">
              <h3>Data Collection</h3>
              <p>I authorize the data collected in the game and the answers to the questionnaire to be collected and stored.</p>
            </div>
            <div class="consent-item">
              <h3>Sharing the Results</h3>
              <p>I authorize the treatment of the data collected for this project with the purpose of analysis, research and dissemination of results in scientific journals or conferences.</p>
            </div>
            <div class="consent-item">
              <h3>Reimbursements</h3>
              <p>You will be provided with an economic incentive of one cinema NOS voucher for your participation.</p>
            </div>
            
            <div class="consent-check">
              <div class="ist-id-container">
                <label for="ist-id-en">Student Number / IST ID:</label>
                <input type="text" id="ist-id-en" class="ist-id-input" placeholder="e.g. ist1105901" required>
              </div>
              <label>
                <input type="checkbox" class="consent-checkbox"> 
                <strong>I have read and understand the above information.</strong>
              </label>
            </div>
          </div>
        </div>

        <!-- SLIDE 2: BRIEFING -->
        <div class="slide" id="en-slide-2">
          <div class="guide-header">
            <h1>DEFUSAL MANUAL</h1>
            <p>General Information</p>
          </div>

          <div class="controls">
            <h2>üéÆ Controls</h2>
            <p>üñ±Ô∏è <strong>Mouse:</strong> Rotate the scene around</p>
            <p>üîç <strong>Mouse wheel:</strong> Zoom in/out</p>
          </div>

          <div class="description">
            <h2>üìã About the Game</h2>
            <p>
              Welcome to the bomb defusal challenge! 
              In this game you will choose a wire to cut with the help of an LLM and a robot.
            </p>
            <p>
              Follow the rules provided below carefully to determine which wire should be cut.
            </p>
          </div>
        </div>

        <!-- SLIDE 3: WIRES PART 1 -->
        <div class="slide" id="en-slide-3">
          <div class="rules-section">
            <h2>‚öôÔ∏è WIRE GUIDE (1/2)</h2>

            <div class="rule-box">
              <h3>Important Information</h3>
              <ul>
                <li>The wire module may contain between <strong>3 to 6 wires</strong></li>
                <li>Only the correct wire needs to be cut to defuse the module</li>
                <li>The order of wires starts with the first one at the top</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>3 Wires</h3>
              <ul>
                <li>If <strong>there are no red wires</strong>, cut the second wire</li>
                <li>Otherwise, if the last wire is <strong>white</strong>, cut the last wire</li>
                <li>Otherwise, if <strong>there is more than one blue wire</strong>, cut the last blue wire</li>
                <li>Otherwise, cut the last wire</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>4 Wires</h3>
              <ul>
                <li>If <strong>there is more than one red wire</strong> and the last digit of the serial number is <strong>odd</strong>, cut the last red wire</li>
                <li>Otherwise, if the last wire is <strong>yellow</strong> and there are no red wires, cut the first wire</li>
                <li>Otherwise, if <strong>there is exactly one blue wire</strong>, cut the first wire</li>
                <li>Otherwise, if <strong>there is more than one yellow wire</strong>, cut the last wire</li>
                <li>Otherwise, cut the second wire</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- SLIDE 4: WIRES PART 2 -->
        <div class="slide" id="en-slide-4">
          <div class="rules-section">
            <h2>‚öôÔ∏è WIRE GUIDE (2/2)</h2>

            <div class="rule-box">
              <h3>5 Wires</h3>
              <ul>
                <li>If the last wire is <strong>black</strong> and the last digit of the serial number is <strong>odd</strong>, cut the fourth wire</li>
                <li>Otherwise, if <strong>there is exactly one red wire</strong> and there is more than one yellow wire, cut the first wire</li>
                <li>Otherwise, if <strong>there are no black wires</strong>, cut the second wire</li>
                <li>Otherwise, cut the first wire</li>
              </ul>
            </div>

            <div class="rule-box">
              <h3>6 Wires</h3>
              <ul>
                <li>If <strong>there are no yellow wires</strong> and the last digit of the serial number is <strong>odd</strong>, cut the third wire</li>
                <li>Otherwise, if <strong>there is exactly one yellow wire</strong> and there is more than one white wire, cut the fourth wire</li>
                <li>Otherwise, if <strong>there are no red wires</strong>, cut the last wire</li>
                <li>Otherwise, cut the fourth wire</li>
              </ul>
            </div>

            <div class="info-box">
              ‚ÑπÔ∏è <strong>Tip:</strong> Study the module carefully before any action. 
              Identify each wire by color and follow the correct rule sequence.
            </div>
          </div>

          <div class="button-container">
            <button class="start-game-btn">‚ñ∂ START GAME</button>
          </div>
        </div>
      </div>

      <!-- FOOTER NAVIGATION -->
      <div class="nav-controls bottom">
        <button id="prev-slide" class="nav-btn" disabled>‚Üê BACK</button>
        <span id="slide-indicator">1 / 4</span>
        <button id="next-slide" class="nav-btn">NEXT ‚Üí</button>
      </div>
    </div>

    <script>
      // --- Language & Slide Management ---
      let currentLang = 'pt';
      let currentSlideIndex = 0;
      const totalSlides = 4;
      
      const langButtons = document.querySelectorAll('.lang-btn');
      const contentWrappers = document.querySelectorAll('.content');
      
      // Navigation Elements
      const prevBtn = document.getElementById('prev-slide');
      const nextBtn = document.getElementById('next-slide');
      const slideIndicator = document.getElementById('slide-indicator');
      const checkboxes = document.querySelectorAll('.consent-checkbox');
      const idInputs = document.querySelectorAll('.ist-id-input');
      const startButtons = document.querySelectorAll('.start-game-btn');
      const progressFill = document.getElementById('progress');

      // Titles
      const titles = {
        pt: "Instru√ß√µes - Keep Talking and Nobody Explodes",
        en: "Guide - Keep Talking and Nobody Explodes"
      };

      // Initialize
      function init() {
        updateSlideVisibility();
        setupEventListeners();
      }

      function setupEventListeners() {
        // Language Toggles
        langButtons.forEach(btn => {
          btn.addEventListener('click', () => {
             const lang = btn.getAttribute('data-lang');
             setLanguage(lang);
          });
        });

        // Navigation
        prevBtn.addEventListener('click', () => changeSlide(-1));
        nextBtn.addEventListener('click', () => changeSlide(1));


        // Start Game
        startButtons.forEach(btn => {
          btn.addEventListener('click', () => {
             // Get ID from the active input (or just take the one that has a value)
            let istId = document.getElementById('ist-id-pt').value.trim() || document.getElementById('ist-id-en').value.trim();
            if (!istId) istId = 'unknown'; // Should be prevented by validation

            const params = new URLSearchParams(window.location.search);
            const condition = params.get('condition') || 'a';
            window.location.href = `/bomb.html?condition=${condition}&participantId=${encodeURIComponent(istId)}`;
          });
        });

        // Input Validation (ID inputs)
        idInputs.forEach(input => {
          input.addEventListener('input', (e) => {
             // Sync inputs
             const val = e.target.value;
             idInputs.forEach(i => i.value = val);
             updateNavigationState();
          });
        });

        // Consent Checkboxes - Enable Next button
        checkboxes.forEach(box => {
          box.addEventListener('change', (e) => {
            // Sync checkboxes across languages for convenience
            checkboxes.forEach(cb => cb.checked = e.target.checked);
            updateNavigationState();
          });
        });
      }

      function setLanguage(lang) {
        currentLang = lang;
        
        // Update UI logic
        document.documentElement.lang = currentLang;
        document.title = titles[currentLang];
        
        // Toggle Buttons
        langButtons.forEach(btn => {
          if (btn.getAttribute('data-lang') === lang) btn.classList.add('active');
          else btn.classList.remove('active');
        });

        // Toggle Content Wrapper
        contentWrappers.forEach(wrapper => {
          if (wrapper.getAttribute('data-lang') === lang) wrapper.classList.add('active');
          else wrapper.classList.remove('active');
        });

        updateSlideVisibility();
      }

      function changeSlide(direction) {
        const newIndex = currentSlideIndex + direction;
        if (newIndex >= 0 && newIndex < totalSlides) {
          currentSlideIndex = newIndex;
          updateSlideVisibility();
        }
      }

      function updateSlideVisibility() {
        // Hide all slides in ALL languages (to be safe)
        document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));

        // Show current slide for current language
        const activeSlideId = `${currentLang}-slide-${currentSlideIndex + 1}`;
        const activeSlide = document.getElementById(activeSlideId);
        if (activeSlide) {
          activeSlide.classList.add('active');
        }

        // Update Indicator
        slideIndicator.textContent = `${currentSlideIndex + 1} / ${totalSlides}`;
        
        // Update Progress Bar
        const progressPct = ((currentSlideIndex + 1) / totalSlides) * 100;
        if (progressFill) progressFill.style.width = `${progressPct}%`;

        updateNavigationState();
      }

      function updateNavigationState() {
        // Prev Button
        prevBtn.disabled = currentSlideIndex === 0;

        // Next Button Logic
        if (currentSlideIndex === totalSlides - 1) {
          nextBtn.style.display = 'none'; // Hide on last slide
        } else {
          nextBtn.style.display = 'inline-block';
          
          
          // Special Case: Slide 1 (Consent)
          if (currentSlideIndex === 0) {
            const currentWrapper = document.querySelector(`.content[data-lang="${currentLang}"]`);
            const isChecked = currentWrapper.querySelector('.consent-checkbox')?.checked;
            const hasId = currentWrapper.querySelector('.ist-id-input')?.value.trim().length > 0;
            
            nextBtn.disabled = !(isChecked && hasId);
          } else {
            nextBtn.disabled = false;
          }
        }
      }

      // Start
      init();
    </script>
  
    <script>
      // Play the guide theme on the guide page only.
      (function() {
        try {
          const theme = new Audio('/audio/csgo_main_theme.mp3');
          theme.loop = true;
          theme.volume = 0.05;

          const tryPlay = () => {
            theme.play().catch(() => {
              // Will retry after user gesture
            });
          };

          // Try to play immediately (may be blocked by autoplay policies)
          tryPlay();

          // Ensure it starts on first user gesture if blocked
          const resume = () => { tryPlay(); window.removeEventListener('click', resume); window.removeEventListener('keydown', resume); };
          window.addEventListener('click', resume);
          window.addEventListener('keydown', resume);
        } catch (e) {
          // ignore if audio cannot be created
        }
      })();
    </script>
  </body>
</html>